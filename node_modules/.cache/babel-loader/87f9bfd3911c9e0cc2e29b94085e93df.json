{"ast":null,"code":"var _jsxFileName = \"/Users/zomme/Github/labs-hri-prototypes/ambidex-idle-sequencer/src/App.js\";\nimport React from 'react';\nimport './App.css';\nimport { data_pr } from './data.js';\n/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */\n\n/*   React classes                                                             */\n\n/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */\n// Media related classes -------------------------------------------------------\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass Placeholder extends React.Component {\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      id: this.props.id,\n      className: \"placeholder\",\n      style: {\n        display: this.props.visibility ? \"block\" : \"none\"\n      },\n      children: this.props.content\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 16,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nclass Video extends React.Component {\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"video\", {\n      id: this.props.id //ref={this.props.videoref}\n      ,\n      style: {\n        visibility: this.props.visibility ? \"visible\" : \"hidden\"\n      },\n      onTimeUpdate: this.props.onTimeUpdate,\n      onEnded: this.props.onEnded,\n      preload: \"auto\",\n      children: [/*#__PURE__*/_jsxDEV(\"source\", {\n        src: this.props.src,\n        type: \"video/mp4\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 39,\n        columnNumber: 9\n      }, this), \"Error to load video\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 31,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nclass Img extends React.Component {\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"img\", {\n      id: this.props.id,\n      src: this.props.src,\n      alt: this.props.id\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 52,\n      columnNumber: 7\n    }, this);\n  }\n\n} // Dashboard related classes ---------------------------------------------------\n\n\nclass Dashboard extends React.Component {\n  makeRangeTable(prOut) {\n    let rows = [];\n    prOut.forEach((item, index) => {\n      let ifClass = '';\n      ifClass = index === 0 ? 'border-top' : ifClass;\n      ifClass += item.isEndOfCat ? (ifClass ? ' ' : '') + 'border-bottom' : '';\n      ifClass += item.isPrev ? (ifClass ? ' ' : '') + 'prev' : '';\n      ifClass += item.isCurrent ? (ifClass ? ' ' : '') + 'active' : '';\n\n      let row = /*#__PURE__*/_jsxDEV(\"tr\", {\n        className: ifClass,\n        children: [/*#__PURE__*/_jsxDEV(\"td\", {\n          children: item.code\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 80,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n          children: parseFloat(item.pr).toFixed(3)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 81,\n          columnNumber: 9\n        }, this)]\n      }, index, true, {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 17\n      }, this);\n\n      rows.push(row);\n    });\n    return rows;\n  }\n\n  render() {\n    let rows = this.makeRangeTable(this.props.prOut);\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ui-container-h ui-container-gap abs-left\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ui-panel\",\n        children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n          children: \"probability\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"table\", {\n          className: \"dashboard\",\n          children: /*#__PURE__*/_jsxDEV(\"tbody\", {\n            id: \"table_dashboard_dice\",\n            children: [/*#__PURE__*/_jsxDEV(\"tr\", {\n              children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                children: \"prev\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 96,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: this.props.prevMotion\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 96,\n                columnNumber: 30\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 96,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                children: \"random\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 97,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: parseFloat(this.props.dice).toFixed(3)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 97,\n                columnNumber: 32\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 97,\n              columnNumber: 13\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 95,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 94,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"table\", {\n          className: \"dashboard\",\n          children: /*#__PURE__*/_jsxDEV(\"tbody\", {\n            id: \"table_dashboard_pr\",\n            children: rows\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 101,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 7\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 7\n    }, this);\n  }\n\n} // Controlboard related classes ------------------------------------------------\n\n\nclass Controlboard extends React.Component {\n  makeBarTable() {\n    const prIn = this.props.data;\n    let rows = [];\n    const data_array = Object.keys(prIn);\n    data_array.forEach((set, setIndex) => {\n      if (set === 'primary' || set === 'secondary') {\n        let contents = [];\n        let value_old = 0;\n        prIn[set].prRatios.forEach((item, index) => {\n          if (index < prIn[set].prRatios.length - 1) {\n            const value = parseInt((item.pr + value_old) * 100);\n\n            const _content = /*#__PURE__*/_jsxDEV(Slider, {\n              id: `slider_${set}_${item.cat}`,\n              cat: item.cat,\n              value: value,\n              onChange: this.props.onSliderChange\n            }, `slider_${set}_${item.cat}`, false, {\n              fileName: _jsxFileName,\n              lineNumber: 126,\n              columnNumber: 30\n            }, this);\n\n            contents.push(_content);\n            value_old += item.pr;\n          }\n        });\n\n        let row = /*#__PURE__*/_jsxDEV(\"tr\", {\n          children: [/*#__PURE__*/_jsxDEV(\"td\", {\n            className: \"header\",\n            children: set\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 138,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n            className: \"cell-slider\",\n            children: contents\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 139,\n            columnNumber: 11\n          }, this)]\n        }, `slidergroup_${set}`, true, {\n          fileName: _jsxFileName,\n          lineNumber: 137,\n          columnNumber: 19\n        }, this);\n\n        rows.push(row);\n      } else {\n        prIn[set].prRatios.forEach((inSet, inSetIndex) => {\n          let contents = [];\n          let value_old = 0;\n          inSet.prRatios.forEach((item, index) => {\n            if (index < inSet.prRatios.length - 1) {\n              const value = parseInt((item.pr + value_old) * 100);\n\n              const _content = /*#__PURE__*/_jsxDEV(Slider, {\n                id: `slider_${item.code}`,\n                cat: inSet.cat,\n                value: value,\n                onChange: this.props.onSliderChange\n              }, `slider_${item.code}`, false, {\n                fileName: _jsxFileName,\n                lineNumber: 150,\n                columnNumber: 32\n              }, this);\n\n              contents.push(_content);\n              value_old += item.pr;\n            }\n          });\n\n          let row = /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: [/*#__PURE__*/_jsxDEV(\"td\", {\n              className: \"header\",\n              children: `${inSet.cat} (${inSet.desc})`\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 162,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              className: \"cell-slider\",\n              children: contents\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 163,\n              columnNumber: 13\n            }, this)]\n          }, inSet.cat, true, {\n            fileName: _jsxFileName,\n            lineNumber: 161,\n            columnNumber: 21\n          }, this);\n\n          if (inSet.prRatios.length > 1) {\n            rows.push(row);\n          }\n        });\n      }\n    });\n    return rows;\n  }\n\n  render() {\n    let content = this.makeBarTable();\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ui-container-v abs-right\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"header-mini\",\n        children: \"probability ratio\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ui-panel round-bottom\",\n        children: /*#__PURE__*/_jsxDEV(\"table\", {\n          className: \"controlpanel\",\n          children: /*#__PURE__*/_jsxDEV(\"tbody\", {\n            children: content\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 181,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 9\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 7\n    }, this);\n  }\n\n} // Footer ----------------------------------------------------------------------\n\n\nclass Footer extends React.Component {\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"footer\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ui-container-h ui-container-gap abs-left\",\n        children: [/*#__PURE__*/_jsxDEV(Btn, {\n          id: \"btn_start\",\n          label: \"idle start\",\n          onClick: () => this.props.onClick('btn_start')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 198,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Btn, {\n          id: \"btn_end\",\n          label: \"idle end\",\n          onClick: () => this.props.onClick('btn_end')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ui-container-h ui-container-gap abs-right\",\n        children: /*#__PURE__*/_jsxDEV(Btn, {\n          id: \"btn_cam\",\n          label: \"change cam\",\n          onClick: () => this.props.onClick('btn_cam')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 210,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Playback, {\n        value: this.props.progressvalue\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nclass Playback extends React.Component {\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"range\",\n      className: \"playback\",\n      min: \"0\",\n      max: \"100\",\n      value: this.props.value,\n      readOnly: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 7\n    }, this);\n  }\n\n} // Generic UI components -------------------------------------------------------\n\n\nclass Btn extends React.Component {\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"button\", {\n      type: \"button\",\n      id: this.props.id,\n      onClick: this.props.onClick,\n      children: this.props.label\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 242,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nclass Slider extends React.Component {\n  constructor(props) {\n    super(props);\n    this.handleChange = this.handleChange.bind(this);\n    this.handleMouseUp = this.handleMouseUp.bind(this);\n  }\n\n  handleChange(e) {\n    const value = e.target.value;\n    return this.props.onChange(this.props.id, value);\n  }\n\n  handleMouseUp(e) {\n    console.log(\"input value changed:\");\n    console.log(`  id: ${this.props.id}, value: ${this.props.value}`);\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"wrapper-slider\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"range\",\n        id: this.props.id,\n        cat: this.props.cat,\n        className: \"controls\",\n        min: 0,\n        max: 100,\n        value: this.props.value,\n        onChange: this.handleChange,\n        onMouseUp: this.handleMouseUp\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 270,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"slider-indicator\",\n        style: {\n          left: `calc(6px + (100% - 12px)*${this.props.value}/100)`\n        },\n        children: this.props.value\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 281,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 269,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n/*******************************************************************************/\n\n/*   Assemble!!!   *************************************************************/\n\n/*******************************************************************************/\n\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    let prevMotion = 'none';\n    let currentMotion = 'none';\n    this.state = {\n      sideCamVisible: false,\n      isIdle: false,\n      videoDuration: 0,\n      videoProgress: 0,\n      prevMotion: prevMotion,\n      currentMotion: currentMotion,\n      dice: 0,\n      trial: 0,\n      prIn: data_pr,\n      prOutType: 1,\n      prOut: this.calcPrOut(data_pr, 1, prevMotion, currentMotion),\n      prOut1: this.calcPrOut(data_pr, 1, prevMotion, currentMotion),\n      prOut2: this.calcPrOut(data_pr, 2, prevMotion, currentMotion)\n    }; //this.videoRefFront = React.createRef();\n\n    this.handleClick = this.handleClick.bind(this);\n    this.handleSlider = this.handleSlider.bind(this);\n    this.handleVideoEnd = this.handleVideoEnd.bind(this);\n  }\n\n  handleClick(id) {\n    console.log(`button pressed: ${id}`);\n\n    switch (id) {\n      case 'btn_start':\n        if (!this.state.isIdle) {\n          this.startVideo();\n        }\n\n        break;\n\n      case 'btn_end':\n        if (this.state.isIdle) {\n          this.stopVideo();\n        }\n\n        break;\n\n      case 'btn_cam':\n        const toggleCam = !this.state.sideCamVisible;\n        this.setState({\n          sideCamVisible: toggleCam\n        }); ///*// DEBUG TOGGLECAM\n\n        console.log(`  sideCamVisible: ${toggleCam}`); //*/// DEBUG TOGGLECAM\n\n        break;\n\n      default:\n        break;\n    }\n  }\n\n  handleSlider(idIn, value) {\n    let data = this.state.prIn;\n    let id = idIn.replace('slider_', ''); // for category ratio\n\n    if (!id.match(/^\\d/)) {\n      const set = id.match(/^\\D*(?=_)/)[0];\n      const cat = parseInt(id.match(/\\d*$/)[0]);\n\n      let _value = parseFloat(value) / 100;\n\n      for (let i = 0; i <= cat; i++) {\n        if (i > 0) {\n          _value -= data[set].prRatios.find(o => o.cat === i - 1).pr;\n        }\n      }\n\n      const _value_diff = _value - parseFloat(data[set].prRatios.find(o => o.cat === cat).pr);\n\n      data[set].prRatios.find(o => o.cat === cat).pr = _value;\n      data[set].prRatios.find(o => o.cat === cat + 1).pr -= _value_diff;\n    } // for motion ratio in category\n    else {\n      const cat = parseInt(id.match(/^\\d*(?=-)/)[0]);\n      let data_cat = data.motionGroup.prRatios.find(o => o.cat === cat).prRatios;\n\n      let _value = parseFloat(value) / 100;\n\n      for (let i = 0; i < data_cat.length - 1; i++) {\n        if (i > 0) {\n          _value -= data_cat[i - 1].pr;\n        }\n      }\n\n      for (let index = 0; index < data_cat.length - 1; index++) {\n        if (data_cat[index].code === id) {\n          const _value_diff = _value - parseFloat(data_cat[index].pr);\n\n          data_cat[index].pr = _value;\n          data_cat[index + 1].pr -= _value_diff;\n          data.motionGroup.prRatios.find(o => o.cat === cat).prRatios[index].pr = _value;\n          data.motionGroup.prRatios.find(o => o.cat === cat).prRatios[index + 1].pr -= _value_diff; //data.motionGroup.prRatios.find(o => o.cat === cat).prRatios = data_cat;\n\n          console.log(data_cat[0].pr);\n          break;\n        }\n      }\n    }\n\n    this.setState({\n      prIn: data\n    });\n    this.setPrOut();\n  }\n\n  showSideCam() {\n    return this.state.sideCamVisible ? \"visible\" : \"hidden\";\n  }\n\n  startVideo() {\n    const id = this.findMotion();\n    const video_front = document.querySelector(`#front_${id}`);\n    const video_side = document.querySelector(`#side_${id}`);\n    video_front.play();\n    video_side.play();\n    console.log(\"from startVideo in App:\");\n    console.log(`  start playing video: ${id}`);\n    console.log(`  video duration: ${video_front.duration}`);\n    this.setState({\n      isIdle: true\n    });\n    this.setState({\n      videoDuration: video_front.duration\n    });\n  }\n\n  stopVideo() {\n    this.setState({\n      isIdle: false\n    });\n  }\n\n  handleVideoTime(id) {\n    const video_front = document.querySelector(`#front_${id}`);\n    const video_progress = video_front.currentTime / this.state.videoDuration * 100;\n    this.setState({\n      videoProgress: video_progress\n    });\n  }\n\n  handleVideoEnd(cam) {\n    if (cam === 'front') {\n      this.setState({\n        videoDuration: 0\n      });\n      console.log(\"from handleVideoEnd in App:\");\n      console.log(\"  video ended\");\n\n      if (this.state.isIdle) {\n        this.startVideo();\n      }\n    }\n  }\n\n  findMotion() {\n    let dice = Math.random();\n    let current = this.state.currentMotion;\n    let prev = this.state.prevMotion;\n    let fix = '1-a';\n    let prOutType = this.state.prOutType;\n    prOutType = prOutType === 1 ? current === fix ? 2 : 1 : 1;\n    let prOut = prOutType === 2 ? this.state.prOut2 : this.state.prOut1;\n    let temp = this.findCurrent(dice, prOut);\n    const trial = this.state.trial + 1; ///*// DEBUG DICE\n\n    console.log(\"from findMotion in App:\");\n    console.log(\"======== iteration start ========\");\n    let debugbar = \"\";\n\n    for (let i = 0; i < 20 - trial.toString().length; i++) {\n      debugbar += \"-\";\n    }\n\n    console.log(`dice trial: ${trial} ${debugbar}`);\n    console.log(`  dice thrown: ${dice.toFixed(3)}`);\n    console.log(`  prev motion: ${current}`);\n    console.log(`  new motion: ${temp}`); //*/// DEBUG DICE\n\n    while (temp === current && temp !== fix) {\n      dice = Math.random();\n      temp = this.findCurrent(dice, prOut); ///*// DEBUG DICE REPEAT\n\n      console.log('  (repeat trial)');\n      console.log(`  dice thrown: ${dice.toFixed(3)}`);\n      console.log(`  new motion: ${temp}`); //*/// DEBUG DICE REPEAT\n    } ///*// DEBUG DICE\n\n\n    console.log(\"(dice trial ends) ---------------\"); //*/// DEBUG DICE\n\n    prev = current;\n    current = temp;\n    prOut.forEach(item => {\n      item.isPrev = false;\n      item.isCurrent = false;\n    });\n    const codes = prOut.map(item => {\n      return item.code;\n    });\n\n    if (codes.includes(prev)) {\n      prOut.find(o => o.code === prev).isPrev = true;\n    }\n\n    prOut.find(o => o.code === current).isCurrent = true;\n    this.setState({\n      dice: dice,\n      trial: trial,\n      prevMotion: prev,\n      currentMotion: current,\n      prOutType: prOutType,\n      prOut: prOut\n    }); ///*// DEBUG PROUT\n\n    console.log(\"prOut: \" + JSON.stringify(this.state.prOut, null, 2)); //*/// DEBUG PROUT\n\n    return current;\n  }\n\n  findCurrent(dice, prOut) {\n    for (let i = 0; i < prOut.length; i++) {\n      if (dice < prOut[i].pr) {\n        return prOut[i].code;\n      }\n    }\n  }\n\n  calcPrOut(prIn, target, prev, current) {\n    let _range = [];\n\n    let _cat;\n\n    let _pr_accum = 0;\n\n    let _data = target === 1 ? prIn.primary.prRatios : prIn.secondary.prRatios;\n\n    prIn.motionGroup.prRatios.forEach((item, index) => {\n      _cat = item.cat;\n\n      let pr_cat = _data.find(o => o.cat === _cat).pr;\n\n      let pr_accum_inCat = 0;\n      _pr_accum += index > 0 ? _data[index - 1].pr : 0;\n      item.prRatios.forEach((item, index, array) => {\n        pr_accum_inCat += pr_cat * item.pr;\n        let pr1 = _pr_accum + pr_accum_inCat;\n        let isCurrent = item.code === current ? true : false;\n        let isPrev = item.code === prev ? true : false;\n        let isEnd = index === array.length - 1 ? true : false;\n        let output = {\n          code: item.code,\n          pr: pr1,\n          cat: _cat,\n          isCurrent: isCurrent,\n          isPrev: isPrev,\n          isEndOfCat: isEnd\n        };\n\n        _range.push(output);\n      });\n    });\n    return _range;\n  }\n\n  setPrOut() {\n    const _pr1 = this.calcPrOut(this.state.prIn, 1, this.state.prevMotion, this.state.currentMotion);\n\n    const _pr2 = this.calcPrOut(this.state.prIn, 2, this.state.prevMotion, this.state.currentMotion);\n\n    const prOut = this.state.prOutType === 2 ? _pr2 : _pr1;\n    this.setState({\n      prOut: prOut,\n      prOut1: _pr1,\n      prOut2: _pr2\n    });\n  }\n\n  renderContents(cam) {\n    let codes = []; //const _videoref = (cam === 'side') ? this.videoRefSide : this.videoRefFront;\n\n    const prOut = this.state.prOut;\n    const current = this.state.currentMotion;\n    prOut.forEach(item => {\n      codes.push(item.code);\n    });\n    let contents = [];\n    codes.forEach(item => {\n      const _isTarget = item === current ? true : false;\n\n      const _content = /*#__PURE__*/_jsxDEV(Video, {\n        //videoref={(_isTarget) ? _videoref : null}\n        id: `${cam}_${item}`,\n        src: require(`./video/${cam}_${item}.mp4`),\n        visibility: _isTarget,\n        onTimeUpdate: () => this.handleVideoTime(item),\n        onEnded: () => this.handleVideoEnd(cam)\n      }, item, false, {\n        fileName: _jsxFileName,\n        lineNumber: 571,\n        columnNumber: 24\n      }, this);\n\n      contents.push(_content);\n    });\n    /*// DEBUG RENDER CONTENTS\n    console.log(\"from renderContents in App:\");\n    console.log(\"  updated video contents\");\n    console.log(`  current motion: ${this.state.currentMotion}`);\n    */\n    // DEBUG RENDER CONTENTS\n\n    return contents;\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"App\",\n      children: [/*#__PURE__*/_jsxDEV(Placeholder, {\n        id: \"box_cam_front\",\n        content: /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(Img, {\n            src: require('./img/front_default.jpg')\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 597,\n            columnNumber: 15\n          }, this), this.renderContents('front')]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 596,\n          columnNumber: 13\n        }, this),\n        visibility: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 593,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Placeholder, {\n        id: \"box_cam_side\",\n        content: /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(Img, {\n            src: require('./img/side_default.jpg')\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 607,\n            columnNumber: 15\n          }, this), this.renderContents('side')]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 606,\n          columnNumber: 13\n        }, this),\n        visibility: this.state.sideCamVisible\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 603,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Dashboard, {\n        prOut: this.state.prOut,\n        prevMotion: this.state.prevMotion,\n        dice: this.state.dice\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 613,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Controlboard, {\n        data: this.state.prIn,\n        onSliderChange: this.handleSlider\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 618,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Footer, {\n        onClick: id => this.handleClick(id),\n        progressvalue: this.state.videoProgress\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 622,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 592,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/zomme/Github/labs-hri-prototypes/ambidex-idle-sequencer/src/App.js"],"names":["React","data_pr","Placeholder","Component","render","props","id","display","visibility","content","Video","onTimeUpdate","onEnded","src","Img","Dashboard","makeRangeTable","prOut","rows","forEach","item","index","ifClass","isEndOfCat","isPrev","isCurrent","row","code","parseFloat","pr","toFixed","push","prevMotion","dice","Controlboard","makeBarTable","prIn","data","data_array","Object","keys","set","setIndex","contents","value_old","prRatios","length","value","parseInt","_content","cat","onSliderChange","inSet","inSetIndex","desc","Footer","onClick","progressvalue","Playback","Btn","label","Slider","constructor","handleChange","bind","handleMouseUp","e","target","onChange","console","log","left","App","currentMotion","state","sideCamVisible","isIdle","videoDuration","videoProgress","trial","prOutType","calcPrOut","prOut1","prOut2","handleClick","handleSlider","handleVideoEnd","startVideo","stopVideo","toggleCam","setState","idIn","replace","match","_value","i","find","o","_value_diff","data_cat","motionGroup","setPrOut","showSideCam","findMotion","video_front","document","querySelector","video_side","play","duration","handleVideoTime","video_progress","currentTime","cam","Math","random","current","prev","fix","temp","findCurrent","debugbar","toString","codes","map","includes","JSON","stringify","_range","_cat","_pr_accum","_data","primary","secondary","pr_cat","pr_accum_inCat","array","pr1","isEnd","output","_pr1","_pr2","renderContents","_isTarget","require"],"mappings":"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","sourcesContent":["import React from 'react';\nimport './App.css';\nimport {data_pr} from './data.js';\n\n\n\n/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */\n/*   React classes                                                             */\n/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */\n\n// Media related classes -------------------------------------------------------\n\nclass Placeholder extends React.Component {\n  render() {\n    return (\n      <div\n        id={this.props.id}\n        className=\"placeholder\"\n        style={{display: this.props.visibility ? \"block\" : \"none\"}}\n      >\n        {this.props.content}\n      </div>\n    );\n  }\n}\n\nclass Video extends React.Component {\n\n  render() {\n    return (\n      <video\n        id={this.props.id}\n        //ref={this.props.videoref}\n        style={{visibility: this.props.visibility ? \"visible\" : \"hidden\"}}\n        onTimeUpdate={this.props.onTimeUpdate}\n        onEnded={this.props.onEnded}\n        preload=\"auto\"\n      >\n        <source\n          src={this.props.src}\n          type=\"video/mp4\"\n        />\n        Error to load video\n      </video>\n    );\n  }\n}\n\nclass Img extends React.Component {\n  render() {\n    return (\n      <img\n        id={this.props.id}\n        src={this.props.src}\n        alt={this.props.id}\n      />\n    );\n  }\n}\n\n// Dashboard related classes ---------------------------------------------------\n\nclass Dashboard extends React.Component {\n\n  makeRangeTable(prOut) {\n    let rows = [];\n    prOut.forEach((item, index) => {\n      let ifClass = '';\n      ifClass = (index === 0) ? 'border-top' : ifClass;\n      ifClass += (item.isEndOfCat) ?\n        ((ifClass ? ' ' : '') + 'border-bottom')\n        : '';\n      ifClass += (item.isPrev) ?\n        ((ifClass ? ' ' : '') + 'prev')\n        : '';\n      ifClass += (item.isCurrent) ?\n        ((ifClass ? ' ' : '') + 'active')\n        : '';\n      let row = <tr key={index} className={ifClass}>\n        <td>{item.code}</td>\n        <td>{parseFloat(item.pr).toFixed(3)}</td>\n        </tr>;\n      rows.push(row);\n    });\n    return rows;\n  }\n\n  render() {\n    let rows = this.makeRangeTable(this.props.prOut);\n    return (\n      <div className=\"ui-container-h ui-container-gap abs-left\">\n      <div className=\"ui-panel\">\n        <h1>probability</h1>\n        <table className=\"dashboard\">\n          <tbody id=\"table_dashboard_dice\">\n            <tr><td>prev</td><td>{this.props.prevMotion}</td></tr>\n            <tr><td>random</td><td>{parseFloat(this.props.dice).toFixed(3)}</td></tr>\n          </tbody>\n        </table>\n        <table className=\"dashboard\">\n          <tbody id=\"table_dashboard_pr\">\n            {rows}\n          </tbody>\n        </table>\n      </div>\n      </div>\n    );\n  }\n}\n\n// Controlboard related classes ------------------------------------------------\n\nclass Controlboard extends React.Component {\n\n  makeBarTable() {\n    const prIn = this.props.data;\n    let rows = [];\n    const data_array = Object.keys(prIn);\n    data_array.forEach((set, setIndex) => {\n      if (set === 'primary' || set === 'secondary') {\n        let contents = [];\n        let value_old = 0;\n        prIn[set].prRatios.forEach((item, index) => {\n          if (index < prIn[set].prRatios.length - 1) {\n            const value = parseInt((item.pr + value_old)*100);\n            const _content = <Slider\n              id={`slider_${set}_${item.cat}`}\n              key={`slider_${set}_${item.cat}`}\n              cat={item.cat}\n              value={value}\n              onChange={this.props.onSliderChange}\n            />;\n            contents.push(_content);\n            value_old += item.pr;\n          }\n        });\n        let row = <tr key={`slidergroup_${set}`}>\n          <td className=\"header\">{set}</td>\n          <td className=\"cell-slider\">{contents}</td>\n        </tr>;\n        rows.push(row);\n      }\n      else {\n        prIn[set].prRatios.forEach((inSet, inSetIndex) => {\n          let contents = [];\n          let value_old = 0;\n          inSet.prRatios.forEach((item, index) => {\n            if (index < inSet.prRatios.length - 1) {\n              const value = parseInt((item.pr + value_old)*100);\n              const _content = <Slider\n                id={`slider_${item.code}`}\n                key={`slider_${item.code}`}\n                cat={inSet.cat}\n                value={value}\n                onChange={this.props.onSliderChange}\n              />;\n              contents.push(_content);\n              value_old += item.pr;\n            }\n          });\n          let row = <tr key={inSet.cat}>\n            <td className=\"header\">{`${inSet.cat} (${inSet.desc})`}</td>\n            <td className=\"cell-slider\">{contents}</td>\n          </tr>;\n          if(inSet.prRatios.length > 1) {\n            rows.push(row);\n          }\n        });\n      }\n    });\n    return rows;\n  }\n\n  render() {\n    let content = this.makeBarTable();\n    return (\n      <div className=\"ui-container-v abs-right\">\n        <div className=\"header-mini\">probability ratio</div>\n        <div className=\"ui-panel round-bottom\">\n        <table className=\"controlpanel\">\n          <tbody>\n            {content}\n          </tbody>\n        </table>\n        </div>\n      </div>\n    );\n  }\n}\n\n// Footer ----------------------------------------------------------------------\n\nclass Footer extends React.Component {\n  render() {\n    return (\n      <div className=\"footer\">\n        <div className=\"ui-container-h ui-container-gap abs-left\">\n          <Btn\n            id=\"btn_start\"\n            label=\"idle start\"\n            onClick={() => this.props.onClick('btn_start')}\n          />\n          <Btn\n            id=\"btn_end\"\n            label=\"idle end\"\n            onClick={() => this.props.onClick('btn_end')}\n          />\n        </div>\n        <div className=\"ui-container-h ui-container-gap abs-right\">\n          <Btn\n            id=\"btn_cam\"\n            label=\"change cam\"\n            onClick={() => this.props.onClick('btn_cam')}\n          />\n        </div>\n        <Playback value={this.props.progressvalue}/>\n      </div>\n    );\n  }\n}\n\nclass Playback extends React.Component {\n  render() {\n    return (\n      <input\n        type=\"range\"\n        className=\"playback\"\n        min=\"0\"\n        max=\"100\"\n        value={this.props.value}\n        readOnly={true}\n      />\n    );\n  }\n}\n\n// Generic UI components -------------------------------------------------------\n\nclass Btn extends React.Component {\n  render() {\n    return (\n      <button\n        type=\"button\"\n        id={this.props.id}\n        onClick={this.props.onClick}\n      >\n        {this.props.label}\n      </button>\n    );\n  }\n}\n\nclass Slider extends React.Component {\n  constructor(props) {\n    super(props);\n    this.handleChange = this.handleChange.bind(this);\n    this.handleMouseUp = this.handleMouseUp.bind(this);\n  }\n  handleChange(e) {\n    const value = e.target.value;\n    return this.props.onChange(this.props.id, value);\n  }\n  handleMouseUp(e) {\n    console.log(\"input value changed:\");\n    console.log(`  id: ${this.props.id}, value: ${this.props.value}`);\n  }\n  render() {\n    return (\n      <div className=\"wrapper-slider\">\n        <input\n          type=\"range\"\n          id={this.props.id}\n          cat={this.props.cat}\n          className='controls'\n          min={0}\n          max={100}\n          value={this.props.value}\n          onChange={this.handleChange}\n          onMouseUp={this.handleMouseUp}\n        />\n        <div\n          className=\"slider-indicator\"\n          style={{left: `calc(6px + (100% - 12px)*${this.props.value}/100)`}}\n        >\n          {this.props.value}</div>\n      </div>\n    );\n  }\n}\n\n/*******************************************************************************/\n/*   Assemble!!!   *************************************************************/\n/*******************************************************************************/\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    let prevMotion = 'none';\n    let currentMotion = 'none';\n    this.state = {\n      sideCamVisible: false,\n      isIdle: false,\n      videoDuration: 0,\n      videoProgress: 0,\n      prevMotion: prevMotion,\n      currentMotion: currentMotion,\n      dice: 0,\n      trial: 0,\n      prIn: data_pr,\n      prOutType: 1,\n      prOut: this.calcPrOut(data_pr, 1, prevMotion, currentMotion),\n      prOut1: this.calcPrOut(data_pr, 1, prevMotion, currentMotion),\n      prOut2: this.calcPrOut(data_pr, 2, prevMotion, currentMotion)\n    };\n    //this.videoRefFront = React.createRef();\n    this.handleClick = this.handleClick.bind(this);\n    this.handleSlider = this.handleSlider.bind(this);\n    this.handleVideoEnd = this.handleVideoEnd.bind(this);\n  }\n\n  handleClick(id) {\n    console.log(`button pressed: ${id}`);\n    switch(id) {\n      case 'btn_start':\n        if(!this.state.isIdle) {\n          this.startVideo();\n        }\n        break;\n      case 'btn_end':\n      if(this.state.isIdle) {\n        this.stopVideo();\n      }\n        break;\n      case 'btn_cam':\n        const toggleCam = !this.state.sideCamVisible;\n        this.setState({sideCamVisible: toggleCam});\n        ///*// DEBUG TOGGLECAM\n        console.log(`  sideCamVisible: ${toggleCam}`);\n        //*/// DEBUG TOGGLECAM\n        break;\n      default:\n        break;\n    }\n  }\n\n  handleSlider(idIn, value) {\n    let data = this.state.prIn;\n    let id = idIn.replace('slider_', '');\n    // for category ratio\n    if(!id.match(/^\\d/)) {\n      const set = id.match(/^\\D*(?=_)/)[0];\n      const cat = parseInt(id.match(/\\d*$/)[0]);\n      let _value = parseFloat(value)/100;\n      for(let i = 0; i <= cat; i++) {\n        if(i > 0) {\n          _value -= data[set].prRatios.find(o => o.cat === i-1).pr;\n        }\n      }\n      const _value_diff = _value -\n        parseFloat(data[set].prRatios.find(o => o.cat === cat).pr);\n      data[set].prRatios.find(o => o.cat === cat).pr = _value;\n      data[set].prRatios.find(o => o.cat === cat+1).pr -= _value_diff;\n    }\n    // for motion ratio in category\n    else {\n      const cat = parseInt(id.match(/^\\d*(?=-)/)[0]);\n      let data_cat = data.motionGroup.prRatios.find(o => o.cat === cat).prRatios;\n      let _value = parseFloat(value)/100;\n      for(let i = 0; i < data_cat.length - 1; i++) {\n        if(i > 0) {\n          _value -= data_cat[i-1].pr;\n        }\n      }\n      for(let index = 0; index < data_cat.length - 1; index++) {\n        if(data_cat[index].code === id) {\n          const _value_diff = _value - parseFloat(data_cat[index].pr);\n          data_cat[index].pr = _value;\n          data_cat[index+1].pr -= _value_diff;\n          data.motionGroup.prRatios\n            .find(o => o.cat === cat)\n            .prRatios[index].pr = _value;\n            data.motionGroup.prRatios\n              .find(o => o.cat === cat)\n              .prRatios[index+1].pr -= _value_diff;\n          //data.motionGroup.prRatios.find(o => o.cat === cat).prRatios = data_cat;\n          console.log(data_cat[0].pr);\n          break;\n        }\n      }\n    }\n    this.setState({prIn: data});\n    this.setPrOut();\n  }\n\n  showSideCam() {\n    return (this.state.sideCamVisible) ? \"visible\" : \"hidden\";\n  }\n\n  startVideo() {\n    const id = this.findMotion();\n    const video_front = document.querySelector(`#front_${id}`);\n    const video_side = document.querySelector(`#side_${id}`);\n    video_front.play();\n    video_side.play();\n    console.log(\"from startVideo in App:\");\n    console.log(`  start playing video: ${id}`);\n    console.log(`  video duration: ${video_front.duration}`);\n    this.setState({isIdle: true})\n    this.setState({videoDuration: video_front.duration})\n  }\n\n  stopVideo() {\n    this.setState({isIdle: false});\n  }\n\n  handleVideoTime(id) {\n    const video_front = document.querySelector(`#front_${id}`);\n    const video_progress =\n      video_front.currentTime / this.state.videoDuration * 100;\n    this.setState({videoProgress: video_progress});\n  }\n\n  handleVideoEnd(cam) {\n    if(cam === 'front') {\n      this.setState({videoDuration: 0});\n      console.log(\"from handleVideoEnd in App:\");\n      console.log(\"  video ended\");\n      if(this.state.isIdle) {\n        this.startVideo();\n      }\n    }\n  }\n\n  findMotion() {\n    let dice = Math.random();\n    let current = this.state.currentMotion;\n    let prev = this.state.prevMotion;\n    let fix = '1-a';\n    let prOutType = this.state.prOutType;\n    prOutType = (prOutType === 1) ?\n      ((current === fix) ? 2 : 1) : 1;\n    let prOut = (prOutType === 2) ? this.state.prOut2 : this.state.prOut1;\n    let temp = this.findCurrent(dice, prOut);\n    const trial = this.state.trial + 1;\n\n    ///*// DEBUG DICE\n    console.log(\"from findMotion in App:\");\n    console.log(\"======== iteration start ========\");\n    let debugbar = \"\";\n    for (let i = 0; i < 20 - trial.toString().length; i++) {\n      debugbar += \"-\";\n    }\n    console.log(`dice trial: ${trial} ${debugbar}`);\n    console.log(`  dice thrown: ${dice.toFixed(3)}`);\n    console.log(`  prev motion: ${current}`);\n    console.log(`  new motion: ${temp}`);\n    //*/// DEBUG DICE\n    while(temp === current && temp !== fix) {\n      dice = Math.random();\n      temp = this.findCurrent(dice, prOut);\n      ///*// DEBUG DICE REPEAT\n      console.log('  (repeat trial)');\n      console.log(`  dice thrown: ${dice.toFixed(3)}`);\n      console.log(`  new motion: ${temp}`);\n      //*/// DEBUG DICE REPEAT\n    }\n    ///*// DEBUG DICE\n    console.log(\"(dice trial ends) ---------------\");\n    //*/// DEBUG DICE\n\n    prev = current;\n    current = temp;\n    prOut.forEach(item => {\n      item.isPrev = false;\n      item.isCurrent = false;\n    });\n    const codes = prOut.map(item => {\n      return item.code;\n    });\n    if(codes.includes(prev)) {\n      prOut.find(o => o.code === prev).isPrev = true;\n    }\n    prOut.find(o => o.code === current).isCurrent = true;\n    this.setState({\n      dice: dice,\n      trial: trial,\n      prevMotion: prev,\n      currentMotion: current,\n      prOutType: prOutType,\n      prOut: prOut\n    });\n\n    ///*// DEBUG PROUT\n    console.log(\"prOut: \" + JSON.stringify(this.state.prOut, null, 2));\n    //*/// DEBUG PROUT\n\n    return current;\n  }\n\n  findCurrent(dice, prOut) {\n    for (let i = 0; i < prOut.length; i++) {\n      if(dice < prOut[i].pr) {\n        return prOut[i].code;\n      }\n    }\n  }\n\n  calcPrOut(prIn, target, prev, current) {\n    let _range = [];\n    let _cat;\n    let _pr_accum = 0;\n    let _data = (target === 1) ?\n      prIn.primary.prRatios : prIn.secondary.prRatios;\n    prIn.motionGroup.prRatios.forEach((item, index) => {\n      _cat = item.cat;\n      let pr_cat = _data.find(o => o.cat === _cat).pr;\n      let pr_accum_inCat = 0;\n      _pr_accum += (index > 0) ? _data[index-1].pr : 0;\n      item.prRatios.forEach((item, index, array) => {\n        pr_accum_inCat += pr_cat * item.pr;\n        let pr1 = _pr_accum + pr_accum_inCat;\n        let isCurrent = (item.code === current) ? true : false;\n        let isPrev = (item.code === prev) ? true : false;\n        let isEnd = (index === array.length - 1) ? true : false;\n        let output = {\n          code: item.code,\n          pr: pr1,\n          cat: _cat,\n          isCurrent: isCurrent,\n          isPrev: isPrev,\n          isEndOfCat: isEnd\n        };\n        _range.push(output);\n      });\n    });\n    return _range;\n  }\n\n  setPrOut() {\n    const _pr1 = this.calcPrOut(\n      this.state.prIn,\n      1,\n      this.state.prevMotion,\n      this.state.currentMotion\n    );\n    const _pr2 = this.calcPrOut(\n      this.state.prIn,\n      2,\n      this.state.prevMotion,\n      this.state.currentMotion\n    );\n    const prOut = (this.state.prOutType === 2) ? _pr2 : _pr1;\n    this.setState({\n      prOut: prOut,\n      prOut1: _pr1,\n      prOut2: _pr2\n    });\n  }\n\n  renderContents(cam) {\n    let codes = [];\n    //const _videoref = (cam === 'side') ? this.videoRefSide : this.videoRefFront;\n    const prOut = this.state.prOut;\n    const current = this.state.currentMotion;\n    prOut.forEach(item => {\n      codes.push(item.code);\n    });\n    let contents = [];\n    codes.forEach(item => {\n      const _isTarget = (item === current) ? true : false;\n      const _content = <Video\n        key={item}\n        //videoref={(_isTarget) ? _videoref : null}\n        id={`${cam}_${item}`}\n        src={require(`./video/${cam}_${item}.mp4`)}\n        visibility={_isTarget}\n        onTimeUpdate={() => this.handleVideoTime(item)}\n        onEnded={() => this.handleVideoEnd(cam)}\n      />;\n      contents.push(_content);\n    });\n    /*// DEBUG RENDER CONTENTS\n    console.log(\"from renderContents in App:\");\n    console.log(\"  updated video contents\");\n    console.log(`  current motion: ${this.state.currentMotion}`);\n    */// DEBUG RENDER CONTENTS\n    return contents;\n  }\n\n  render() {\n    return (\n      <div className=\"App\">\n        <Placeholder\n        id=\"box_cam_front\"\n          content={\n            <div>\n              <Img src={require('./img/front_default.jpg')}/>\n              {this.renderContents('front')}\n            </div>\n          }\n          visibility={true}\n        />\n        <Placeholder\n        id=\"box_cam_side\"\n          content={\n            <div>\n              <Img src={require('./img/side_default.jpg')}/>\n              {this.renderContents('side')}\n            </div>\n          }\n          visibility={this.state.sideCamVisible}\n        />\n        <Dashboard\n          prOut={this.state.prOut}\n          prevMotion={this.state.prevMotion}\n          dice={this.state.dice}\n        />\n        <Controlboard\n          data={this.state.prIn}\n          onSliderChange={this.handleSlider}\n          />\n        <Footer\n          onClick={id => this.handleClick(id)}\n          progressvalue={this.state.videoProgress}\n        />\n      </div>\n    );\n  }\n}\nexport default App;\n"]},"metadata":{},"sourceType":"module"}
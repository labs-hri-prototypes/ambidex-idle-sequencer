{"ast":null,"code":"import _assertThisInitialized from\"/Users/zomme/Github/labs-hri-prototypes/ambidex-idle-sequencer/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";import _classCallCheck from\"/Users/zomme/Github/labs-hri-prototypes/ambidex-idle-sequencer/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/zomme/Github/labs-hri-prototypes/ambidex-idle-sequencer/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/zomme/Github/labs-hri-prototypes/ambidex-idle-sequencer/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/zomme/Github/labs-hri-prototypes/ambidex-idle-sequencer/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React from'react';import'./App.css';import{data_pr}from'./data.js';/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */ /*   React classes                                                             */ /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */ // Media related classes -------------------------------------------------------\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Placeholder=/*#__PURE__*/function(_React$Component){_inherits(Placeholder,_React$Component);var _super=_createSuper(Placeholder);function Placeholder(){_classCallCheck(this,Placeholder);return _super.apply(this,arguments);}_createClass(Placeholder,[{key:\"render\",value:function render(){return/*#__PURE__*/_jsx(\"div\",{id:this.props.id,className:\"placeholder\",style:{display:this.props.visibility?\"block\":\"none\"},children:this.props.content});}}]);return Placeholder;}(React.Component);var Video=/*#__PURE__*/function(_React$Component2){_inherits(Video,_React$Component2);var _super2=_createSuper(Video);function Video(){_classCallCheck(this,Video);return _super2.apply(this,arguments);}_createClass(Video,[{key:\"render\",value:function render(){return/*#__PURE__*/_jsxs(\"video\",{id:this.props.id//ref={this.props.videoref}\n,style:{visibility:this.props.visibility?\"visible\":\"hidden\"},onTimeUpdate:this.props.onTimeUpdate,onEnded:this.props.onEnded,preload:\"auto\",children:[/*#__PURE__*/_jsx(\"source\",{src:this.props.src,type:\"video/mp4\"}),\"Error to load video\"]});}}]);return Video;}(React.Component);var Img=/*#__PURE__*/function(_React$Component3){_inherits(Img,_React$Component3);var _super3=_createSuper(Img);function Img(){_classCallCheck(this,Img);return _super3.apply(this,arguments);}_createClass(Img,[{key:\"render\",value:function render(){return/*#__PURE__*/_jsx(\"img\",{id:this.props.id,src:this.props.src,alt:this.props.id});}}]);return Img;}(React.Component);// Dashboard related classes ---------------------------------------------------\nvar Dashboard=/*#__PURE__*/function(_React$Component4){_inherits(Dashboard,_React$Component4);var _super4=_createSuper(Dashboard);function Dashboard(){_classCallCheck(this,Dashboard);return _super4.apply(this,arguments);}_createClass(Dashboard,[{key:\"makeRangeTable\",value:function makeRangeTable(prOut){var rows=[];prOut.forEach(function(item,index){var ifClass='';ifClass=index===0?'border-top':ifClass;ifClass+=item.isEndOfCat?(ifClass?' ':'')+'border-bottom':'';ifClass+=item.isPrev?(ifClass?' ':'')+'prev':'';ifClass+=item.isCurrent?(ifClass?' ':'')+'active':'';var row=/*#__PURE__*/_jsxs(\"tr\",{className:ifClass,children:[/*#__PURE__*/_jsx(\"td\",{children:item.code}),/*#__PURE__*/_jsx(\"td\",{children:parseFloat(item.pr).toFixed(3)})]},index);rows.push(row);});return rows;}},{key:\"render\",value:function render(){var rows=this.makeRangeTable(this.props.prOut);return/*#__PURE__*/_jsx(\"div\",{className:\"ui-container-h ui-container-gap abs-left\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"ui-panel\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"probability\"}),/*#__PURE__*/_jsx(\"table\",{className:\"dashboard\",children:/*#__PURE__*/_jsxs(\"tbody\",{id:\"table_dashboard_dice\",children:[/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:\"prev\"}),/*#__PURE__*/_jsx(\"td\",{children:this.props.prevMotion})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:\"random\"}),/*#__PURE__*/_jsx(\"td\",{children:parseFloat(this.props.dice).toFixed(3)})]})]})}),/*#__PURE__*/_jsx(\"table\",{className:\"dashboard\",children:/*#__PURE__*/_jsx(\"tbody\",{id:\"table_dashboard_pr\",children:rows})})]})});}}]);return Dashboard;}(React.Component);// Controlboard related classes ------------------------------------------------\nvar Controlboard=/*#__PURE__*/function(_React$Component5){_inherits(Controlboard,_React$Component5);var _super5=_createSuper(Controlboard);function Controlboard(){_classCallCheck(this,Controlboard);return _super5.apply(this,arguments);}_createClass(Controlboard,[{key:\"makeBarTable\",value:function makeBarTable(){var _this=this;var prIn=this.props.data;var rows=[];var data_array=Object.keys(prIn);data_array.forEach(function(set,setIndex){if(set==='primary'||set==='secondary'){var contents=[];var value_old=0;prIn[set].prRatios.forEach(function(item,index){if(index<prIn[set].prRatios.length-1){var value=parseInt((item.pr+value_old)*100);var _content=/*#__PURE__*/_jsx(Slider,{id:\"slider_\".concat(set,\"_\").concat(item.cat),cat:item.cat,value:value,onChange:_this.props.onSliderChange},\"slider_\".concat(set,\"_\").concat(item.cat));contents.push(_content);value_old+=item.pr;}});var row=/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"header\",children:set}),/*#__PURE__*/_jsx(\"td\",{className:\"cell-slider\",children:contents})]},\"slidergroup_\".concat(set));rows.push(row);}else{prIn[set].prRatios.forEach(function(inSet,inSetIndex){var contents=[];var value_old=0;inSet.prRatios.forEach(function(item,index){if(index<inSet.prRatios.length-1){var value=parseInt((item.pr+value_old)*100);var _content=/*#__PURE__*/_jsx(Slider,{id:\"slider_\".concat(item.code),cat:inSet.cat,value:value,onChange:_this.props.onSliderChange},\"slider_\".concat(item.code));contents.push(_content);value_old+=item.pr;}});var row=/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"header\",children:\"\".concat(inSet.cat,\" (\").concat(inSet.desc,\")\")}),/*#__PURE__*/_jsx(\"td\",{className:\"cell-slider\",children:contents})]},inSet.cat);if(inSet.prRatios.length>1){rows.push(row);}});}});return rows;}},{key:\"render\",value:function render(){var content=this.makeBarTable();return/*#__PURE__*/_jsxs(\"div\",{className:\"ui-container-v abs-right\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"header-mini\",children:\"probability ratio\"}),/*#__PURE__*/_jsx(\"div\",{className:\"ui-panel round-bottom\",children:/*#__PURE__*/_jsx(\"table\",{className:\"controlpanel\",children:/*#__PURE__*/_jsx(\"tbody\",{children:content})})})]});}}]);return Controlboard;}(React.Component);// Footer ----------------------------------------------------------------------\nvar Footer=/*#__PURE__*/function(_React$Component6){_inherits(Footer,_React$Component6);var _super6=_createSuper(Footer);function Footer(){_classCallCheck(this,Footer);return _super6.apply(this,arguments);}_createClass(Footer,[{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/_jsxs(\"div\",{className:\"footer\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"ui-container-h ui-container-gap abs-left\",children:[/*#__PURE__*/_jsx(Btn,{id:\"btn_start\",label:\"idle start\",onClick:function onClick(){return _this2.props.onClick('btn_start');}}),/*#__PURE__*/_jsx(Btn,{id:\"btn_end\",label:\"idle end\",onClick:function onClick(){return _this2.props.onClick('btn_end');}})]}),/*#__PURE__*/_jsx(\"div\",{className:\"ui-container-h ui-container-gap abs-right\",children:/*#__PURE__*/_jsx(Btn,{id:\"btn_cam\",label:\"change cam\",onClick:function onClick(){return _this2.props.onClick('btn_cam');}})}),/*#__PURE__*/_jsx(Playback,{value:this.props.progressvalue})]});}}]);return Footer;}(React.Component);var Playback=/*#__PURE__*/function(_React$Component7){_inherits(Playback,_React$Component7);var _super7=_createSuper(Playback);function Playback(){_classCallCheck(this,Playback);return _super7.apply(this,arguments);}_createClass(Playback,[{key:\"render\",value:function render(){return/*#__PURE__*/_jsx(\"input\",{type:\"range\",className:\"playback\",min:\"0\",max:\"100\",value:this.props.value,readOnly:true});}}]);return Playback;}(React.Component);// Generic UI components -------------------------------------------------------\nvar Btn=/*#__PURE__*/function(_React$Component8){_inherits(Btn,_React$Component8);var _super8=_createSuper(Btn);function Btn(){_classCallCheck(this,Btn);return _super8.apply(this,arguments);}_createClass(Btn,[{key:\"render\",value:function render(){return/*#__PURE__*/_jsx(\"button\",{type:\"button\",id:this.props.id,onClick:this.props.onClick,children:this.props.label});}}]);return Btn;}(React.Component);var Slider=/*#__PURE__*/function(_React$Component9){_inherits(Slider,_React$Component9);var _super9=_createSuper(Slider);function Slider(props){var _this3;_classCallCheck(this,Slider);_this3=_super9.call(this,props);_this3.handleChange=_this3.handleChange.bind(_assertThisInitialized(_this3));_this3.handleMouseUp=_this3.handleMouseUp.bind(_assertThisInitialized(_this3));return _this3;}_createClass(Slider,[{key:\"handleChange\",value:function handleChange(e){var value=e.target.value;return this.props.onChange(this.props.id,value);}},{key:\"handleMouseUp\",value:function handleMouseUp(e){console.log(\"input value changed:\");console.log(\"  id: \".concat(this.props.id,\", value: \").concat(this.props.value));}},{key:\"render\",value:function render(){return/*#__PURE__*/_jsxs(\"div\",{className:\"wrapper-slider\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"range\",id:this.props.id,cat:this.props.cat,className:\"controls\",min:0,max:100,value:this.props.value,onChange:this.handleChange,onMouseUp:this.handleMouseUp}),/*#__PURE__*/_jsx(\"div\",{className:\"slider-indicator\",style:{left:\"calc(6px + (100% - 12px)*\".concat(this.props.value,\"/100)\")},children:this.props.value})]});}}]);return Slider;}(React.Component);/*******************************************************************************/ /*   Assemble!!!   *************************************************************/ /*******************************************************************************/var App=/*#__PURE__*/function(_React$Component10){_inherits(App,_React$Component10);var _super10=_createSuper(App);function App(props){var _this4;_classCallCheck(this,App);_this4=_super10.call(this,props);var prevMotion='none';var currentMotion='none';_this4.state={sideCamVisible:false,isIdle:false,videoDuration:0,videoProgress:0,prevMotion:prevMotion,currentMotion:currentMotion,dice:0,trial:0,prIn:data_pr,prOutType:1,prOut:_this4.calcPrOut(data_pr,1,prevMotion,currentMotion),prOut1:_this4.calcPrOut(data_pr,1,prevMotion,currentMotion),prOut2:_this4.calcPrOut(data_pr,2,prevMotion,currentMotion)};//this.videoRefFront = React.createRef();\n_this4.handleClick=_this4.handleClick.bind(_assertThisInitialized(_this4));_this4.handleSlider=_this4.handleSlider.bind(_assertThisInitialized(_this4));_this4.handleVideoEnd=_this4.handleVideoEnd.bind(_assertThisInitialized(_this4));return _this4;}_createClass(App,[{key:\"handleClick\",value:function handleClick(id){console.log(\"button pressed: \".concat(id));switch(id){case'btn_start':if(!this.state.isIdle){this.startVideo();}break;case'btn_end':if(this.state.isIdle){this.stopVideo();}break;case'btn_cam':var toggleCam=!this.state.sideCamVisible;this.setState({sideCamVisible:toggleCam});///*// DEBUG TOGGLECAM\nconsole.log(\"  sideCamVisible: \".concat(toggleCam));//*/// DEBUG TOGGLECAM\nbreak;default:break;}}},{key:\"handleSlider\",value:function handleSlider(idIn,value){var data=this.state.prIn;var id=idIn.replace('slider_','');// for category ratio\nif(!id.match(/^\\d/)){var set=id.match(/^\\D*(?=_)/)[0];var cat=parseInt(id.match(/\\d*$/)[0]);var _value=parseFloat(value)/100;var _loop=function _loop(i){if(i>0){_value-=data[set].prRatios.find(function(o){return o.cat===i-1;}).pr;}};for(var i=0;i<=cat;i++){_loop(i);}var _value_diff=_value-parseFloat(data[set].prRatios.find(function(o){return o.cat===cat;}).pr);data[set].prRatios.find(function(o){return o.cat===cat;}).pr=_value;data[set].prRatios.find(function(o){return o.cat===cat+1;}).pr-=_value_diff;}// for motion ratio in category\nelse{var _cat2=parseInt(id.match(/^\\d*(?=-)/)[0]);var data_cat=data.motionGroup.prRatios.find(function(o){return o.cat===_cat2;}).prRatios;var key=data_cat.indexOf(data_cat.find(function(o){return o.code===id;}));var _value2=parseFloat(value)/100;for(var _i=0;_i<=key;_i++){if(_i>0){_value2-=data_cat[_i-1].pr;}}var _value_diff2=_value2-parseFloat(data_cat[key].pr);data_cat[key].pr=_value2;data_cat[key+1].pr-=_value_diff2;data.motionGroup.prRatios.find(function(o){return o.cat===_cat2;}).prRatios=data_cat;}this.setState({prIn:data});this.setPrOut();}},{key:\"showSideCam\",value:function showSideCam(){return this.state.sideCamVisible?\"visible\":\"hidden\";}},{key:\"startVideo\",value:function startVideo(){var id=this.findMotion();var video_front=document.querySelector(\"#front_\".concat(id));var video_side=document.querySelector(\"#side_\".concat(id));video_front.play();video_side.play();console.log(\"from startVideo in App:\");console.log(\"  start playing video: \".concat(id));console.log(\"  video duration: \".concat(video_front.duration));this.setState({isIdle:true});this.setState({videoDuration:video_front.duration});}},{key:\"stopVideo\",value:function stopVideo(){this.setState({isIdle:false});}},{key:\"handleVideoTime\",value:function handleVideoTime(id){var video_front=document.querySelector(\"#front_\".concat(id));var video_progress=video_front.currentTime/this.state.videoDuration*100;this.setState({videoProgress:video_progress});}},{key:\"handleVideoEnd\",value:function handleVideoEnd(cam){if(cam==='front'){this.setState({videoDuration:0});console.log(\"from handleVideoEnd in App:\");console.log(\"  video ended\");if(this.state.isIdle){this.startVideo();}}}},{key:\"findMotion\",value:function findMotion(){var dice=Math.random();var current=this.state.currentMotion;var prev=this.state.prevMotion;var fix='1-a';var prOutType=this.state.prOutType;prOutType=prOutType===1?current===fix?2:1:1;var prOut=prOutType===2?this.state.prOut2:this.state.prOut1;var temp=this.findCurrent(dice,prOut);var trial=this.state.trial+1;///*// DEBUG DICE\nconsole.log(\"from findMotion in App:\");console.log(\"======== iteration start ========\");var debugbar=\"\";for(var i=0;i<20-trial.toString().length;i++){debugbar+=\"-\";}console.log(\"dice trial: \".concat(trial,\" \").concat(debugbar));console.log(\"  dice thrown: \".concat(dice.toFixed(3)));console.log(\"  prev motion: \".concat(current));console.log(\"  new motion: \".concat(temp));//*/// DEBUG DICE\nwhile(temp===current&&temp!==fix){dice=Math.random();temp=this.findCurrent(dice,prOut);///*// DEBUG DICE REPEAT\nconsole.log('  (repeat trial)');console.log(\"  dice thrown: \".concat(dice.toFixed(3)));console.log(\"  new motion: \".concat(temp));//*/// DEBUG DICE REPEAT\n}///*// DEBUG DICE\nconsole.log(\"(dice trial ends) ---------------\");//*/// DEBUG DICE\nprev=current;current=temp;prOut.forEach(function(item){item.isPrev=false;item.isCurrent=false;});var codes=prOut.map(function(item){return item.code;});if(codes.includes(prev)){prOut.find(function(o){return o.code===prev;}).isPrev=true;}prOut.find(function(o){return o.code===current;}).isCurrent=true;this.setState({dice:dice,trial:trial,prevMotion:prev,currentMotion:current,prOutType:prOutType,prOut:prOut});///*// DEBUG PROUT\nconsole.log(\"prOut: \"+JSON.stringify(this.state.prOut,null,2));//*/// DEBUG PROUT\nreturn current;}},{key:\"findCurrent\",value:function findCurrent(dice,prOut){for(var i=0;i<prOut.length;i++){if(dice<prOut[i].pr){return prOut[i].code;}}}},{key:\"calcPrOut\",value:function calcPrOut(prIn,target,prev,current){var _range=[];var _cat;var _pr_accum=0;var _data=target===1?prIn.primary.prRatios:prIn.secondary.prRatios;prIn.motionGroup.prRatios.forEach(function(item,index){_cat=item.cat;var pr_cat=_data.find(function(o){return o.cat===_cat;}).pr;var pr_accum_inCat=0;_pr_accum+=index>0?_data[index-1].pr:0;item.prRatios.forEach(function(item,index,array){pr_accum_inCat+=pr_cat*item.pr;var pr1=_pr_accum+pr_accum_inCat;var isCurrent=item.code===current?true:false;var isPrev=item.code===prev?true:false;var isEnd=index===array.length-1?true:false;var output={code:item.code,pr:pr1,cat:_cat,isCurrent:isCurrent,isPrev:isPrev,isEndOfCat:isEnd};_range.push(output);});});return _range;}},{key:\"setPrOut\",value:function setPrOut(){var _pr1=this.calcPrOut(this.state.prIn,1,this.state.prevMotion,this.state.currentMotion);var _pr2=this.calcPrOut(this.state.prIn,2,this.state.prevMotion,this.state.currentMotion);var prOut=this.state.prOutType===2?_pr2:_pr1;this.setState({prOut:prOut,prOut1:_pr1,prOut2:_pr2});}},{key:\"renderContents\",value:function renderContents(cam){var _this5=this;var codes=[];//const _videoref = (cam === 'side') ? this.videoRefSide : this.videoRefFront;\nvar prOut=this.state.prOut;var current=this.state.currentMotion;prOut.forEach(function(item){codes.push(item.code);});var contents=[];codes.forEach(function(item){var _isTarget=item===current?true:false;var _content=/*#__PURE__*/_jsx(Video,{//videoref={(_isTarget) ? _videoref : null}\nid:\"\".concat(cam,\"_\").concat(item),src:require(\"./video/\".concat(cam,\"_\").concat(item,\".mp4\")),visibility:_isTarget,onTimeUpdate:function onTimeUpdate(){return _this5.handleVideoTime(item);},onEnded:function onEnded(){return _this5.handleVideoEnd(cam);}},item);contents.push(_content);});/*// DEBUG RENDER CONTENTS\n    console.log(\"from renderContents in App:\");\n    console.log(\"  updated video contents\");\n    console.log(`  current motion: ${this.state.currentMotion}`);\n    */ // DEBUG RENDER CONTENTS\nreturn contents;}},{key:\"render\",value:function render(){var _this6=this;return/*#__PURE__*/_jsxs(\"div\",{className:\"App\",children:[/*#__PURE__*/_jsx(Placeholder,{id:\"box_cam_front\",content:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Img,{src:require('./img/front_default.jpg')}),this.renderContents('front')]}),visibility:true}),/*#__PURE__*/_jsx(Placeholder,{id:\"box_cam_side\",content:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Img,{src:require('./img/side_default.jpg')}),this.renderContents('side')]}),visibility:this.state.sideCamVisible}),/*#__PURE__*/_jsx(Dashboard,{prOut:this.state.prOut,prevMotion:this.state.prevMotion,dice:this.state.dice}),/*#__PURE__*/_jsx(Controlboard,{data:this.state.prIn,onSliderChange:this.handleSlider}),/*#__PURE__*/_jsx(Footer,{onClick:function onClick(id){return _this6.handleClick(id);},progressvalue:this.state.videoProgress})]});}}]);return App;}(React.Component);export default App;","map":{"version":3,"sources":["/Users/zomme/Github/labs-hri-prototypes/ambidex-idle-sequencer/src/App.js"],"names":["React","data_pr","Placeholder","props","id","display","visibility","content","Component","Video","onTimeUpdate","onEnded","src","Img","Dashboard","prOut","rows","forEach","item","index","ifClass","isEndOfCat","isPrev","isCurrent","row","code","parseFloat","pr","toFixed","push","makeRangeTable","prevMotion","dice","Controlboard","prIn","data","data_array","Object","keys","set","setIndex","contents","value_old","prRatios","length","value","parseInt","_content","cat","onSliderChange","inSet","inSetIndex","desc","makeBarTable","Footer","onClick","progressvalue","Playback","Btn","label","Slider","handleChange","bind","handleMouseUp","e","target","onChange","console","log","left","App","currentMotion","state","sideCamVisible","isIdle","videoDuration","videoProgress","trial","prOutType","calcPrOut","prOut1","prOut2","handleClick","handleSlider","handleVideoEnd","startVideo","stopVideo","toggleCam","setState","idIn","replace","match","_value","i","find","o","_value_diff","data_cat","motionGroup","key","indexOf","setPrOut","findMotion","video_front","document","querySelector","video_side","play","duration","video_progress","currentTime","cam","Math","random","current","prev","fix","temp","findCurrent","debugbar","toString","codes","map","includes","JSON","stringify","_range","_cat","_pr_accum","_data","primary","secondary","pr_cat","pr_accum_inCat","array","pr1","isEnd","output","_pr1","_pr2","_isTarget","require","handleVideoTime","renderContents"],"mappings":"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","sourcesContent":["import React from 'react';\nimport './App.css';\nimport {data_pr} from './data.js';\n\n\n\n/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */\n/*   React classes                                                             */\n/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */\n\n// Media related classes -------------------------------------------------------\n\nclass Placeholder extends React.Component {\n  render() {\n    return (\n      <div\n        id={this.props.id}\n        className=\"placeholder\"\n        style={{display: this.props.visibility ? \"block\" : \"none\"}}\n      >\n        {this.props.content}\n      </div>\n    );\n  }\n}\n\nclass Video extends React.Component {\n\n  render() {\n    return (\n      <video\n        id={this.props.id}\n        //ref={this.props.videoref}\n        style={{visibility: this.props.visibility ? \"visible\" : \"hidden\"}}\n        onTimeUpdate={this.props.onTimeUpdate}\n        onEnded={this.props.onEnded}\n        preload=\"auto\"\n      >\n        <source\n          src={this.props.src}\n          type=\"video/mp4\"\n        />\n        Error to load video\n      </video>\n    );\n  }\n}\n\nclass Img extends React.Component {\n  render() {\n    return (\n      <img\n        id={this.props.id}\n        src={this.props.src}\n        alt={this.props.id}\n      />\n    );\n  }\n}\n\n// Dashboard related classes ---------------------------------------------------\n\nclass Dashboard extends React.Component {\n\n  makeRangeTable(prOut) {\n    let rows = [];\n    prOut.forEach((item, index) => {\n      let ifClass = '';\n      ifClass = (index === 0) ? 'border-top' : ifClass;\n      ifClass += (item.isEndOfCat) ?\n        ((ifClass ? ' ' : '') + 'border-bottom')\n        : '';\n      ifClass += (item.isPrev) ?\n        ((ifClass ? ' ' : '') + 'prev')\n        : '';\n      ifClass += (item.isCurrent) ?\n        ((ifClass ? ' ' : '') + 'active')\n        : '';\n      let row = <tr key={index} className={ifClass}>\n        <td>{item.code}</td>\n        <td>{parseFloat(item.pr).toFixed(3)}</td>\n        </tr>;\n      rows.push(row);\n    });\n    return rows;\n  }\n\n  render() {\n    let rows = this.makeRangeTable(this.props.prOut);\n    return (\n      <div className=\"ui-container-h ui-container-gap abs-left\">\n      <div className=\"ui-panel\">\n        <h1>probability</h1>\n        <table className=\"dashboard\">\n          <tbody id=\"table_dashboard_dice\">\n            <tr><td>prev</td><td>{this.props.prevMotion}</td></tr>\n            <tr><td>random</td><td>{parseFloat(this.props.dice).toFixed(3)}</td></tr>\n          </tbody>\n        </table>\n        <table className=\"dashboard\">\n          <tbody id=\"table_dashboard_pr\">\n            {rows}\n          </tbody>\n        </table>\n      </div>\n      </div>\n    );\n  }\n}\n\n// Controlboard related classes ------------------------------------------------\n\nclass Controlboard extends React.Component {\n\n  makeBarTable() {\n    const prIn = this.props.data;\n    let rows = [];\n    const data_array = Object.keys(prIn);\n    data_array.forEach((set, setIndex) => {\n      if (set === 'primary' || set === 'secondary') {\n        let contents = [];\n        let value_old = 0;\n        prIn[set].prRatios.forEach((item, index) => {\n          if (index < prIn[set].prRatios.length - 1) {\n            const value = parseInt((item.pr + value_old)*100);\n            const _content = <Slider\n              id={`slider_${set}_${item.cat}`}\n              key={`slider_${set}_${item.cat}`}\n              cat={item.cat}\n              value={value}\n              onChange={this.props.onSliderChange}\n            />;\n            contents.push(_content);\n            value_old += item.pr;\n          }\n        });\n        let row = <tr key={`slidergroup_${set}`}>\n          <td className=\"header\">{set}</td>\n          <td className=\"cell-slider\">{contents}</td>\n        </tr>;\n        rows.push(row);\n      }\n      else {\n        prIn[set].prRatios.forEach((inSet, inSetIndex) => {\n          let contents = [];\n          let value_old = 0;\n          inSet.prRatios.forEach((item, index) => {\n            if (index < inSet.prRatios.length - 1) {\n              const value = parseInt((item.pr + value_old)*100);\n              const _content = <Slider\n                id={`slider_${item.code}`}\n                key={`slider_${item.code}`}\n                cat={inSet.cat}\n                value={value}\n                onChange={this.props.onSliderChange}\n              />;\n              contents.push(_content);\n              value_old += item.pr;\n            }\n          });\n          let row = <tr key={inSet.cat}>\n            <td className=\"header\">{`${inSet.cat} (${inSet.desc})`}</td>\n            <td className=\"cell-slider\">{contents}</td>\n          </tr>;\n          if(inSet.prRatios.length > 1) {\n            rows.push(row);\n          }\n        });\n      }\n    });\n    return rows;\n  }\n\n  render() {\n    let content = this.makeBarTable();\n    return (\n      <div className=\"ui-container-v abs-right\">\n        <div className=\"header-mini\">probability ratio</div>\n        <div className=\"ui-panel round-bottom\">\n        <table className=\"controlpanel\">\n          <tbody>\n            {content}\n          </tbody>\n        </table>\n        </div>\n      </div>\n    );\n  }\n}\n\n// Footer ----------------------------------------------------------------------\n\nclass Footer extends React.Component {\n  render() {\n    return (\n      <div className=\"footer\">\n        <div className=\"ui-container-h ui-container-gap abs-left\">\n          <Btn\n            id=\"btn_start\"\n            label=\"idle start\"\n            onClick={() => this.props.onClick('btn_start')}\n          />\n          <Btn\n            id=\"btn_end\"\n            label=\"idle end\"\n            onClick={() => this.props.onClick('btn_end')}\n          />\n        </div>\n        <div className=\"ui-container-h ui-container-gap abs-right\">\n          <Btn\n            id=\"btn_cam\"\n            label=\"change cam\"\n            onClick={() => this.props.onClick('btn_cam')}\n          />\n        </div>\n        <Playback value={this.props.progressvalue}/>\n      </div>\n    );\n  }\n}\n\nclass Playback extends React.Component {\n  render() {\n    return (\n      <input\n        type=\"range\"\n        className=\"playback\"\n        min=\"0\"\n        max=\"100\"\n        value={this.props.value}\n        readOnly={true}\n      />\n    );\n  }\n}\n\n// Generic UI components -------------------------------------------------------\n\nclass Btn extends React.Component {\n  render() {\n    return (\n      <button\n        type=\"button\"\n        id={this.props.id}\n        onClick={this.props.onClick}\n      >\n        {this.props.label}\n      </button>\n    );\n  }\n}\n\nclass Slider extends React.Component {\n  constructor(props) {\n    super(props);\n    this.handleChange = this.handleChange.bind(this);\n    this.handleMouseUp = this.handleMouseUp.bind(this);\n  }\n  handleChange(e) {\n    const value = e.target.value;\n    return this.props.onChange(this.props.id, value);\n  }\n  handleMouseUp(e) {\n    console.log(\"input value changed:\");\n    console.log(`  id: ${this.props.id}, value: ${this.props.value}`);\n  }\n  render() {\n    return (\n      <div className=\"wrapper-slider\">\n        <input\n          type=\"range\"\n          id={this.props.id}\n          cat={this.props.cat}\n          className='controls'\n          min={0}\n          max={100}\n          value={this.props.value}\n          onChange={this.handleChange}\n          onMouseUp={this.handleMouseUp}\n        />\n        <div\n          className=\"slider-indicator\"\n          style={{left: `calc(6px + (100% - 12px)*${this.props.value}/100)`}}\n        >\n          {this.props.value}</div>\n      </div>\n    );\n  }\n}\n\n/*******************************************************************************/\n/*   Assemble!!!   *************************************************************/\n/*******************************************************************************/\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    let prevMotion = 'none';\n    let currentMotion = 'none';\n    this.state = {\n      sideCamVisible: false,\n      isIdle: false,\n      videoDuration: 0,\n      videoProgress: 0,\n      prevMotion: prevMotion,\n      currentMotion: currentMotion,\n      dice: 0,\n      trial: 0,\n      prIn: data_pr,\n      prOutType: 1,\n      prOut: this.calcPrOut(data_pr, 1, prevMotion, currentMotion),\n      prOut1: this.calcPrOut(data_pr, 1, prevMotion, currentMotion),\n      prOut2: this.calcPrOut(data_pr, 2, prevMotion, currentMotion)\n    };\n    //this.videoRefFront = React.createRef();\n    this.handleClick = this.handleClick.bind(this);\n    this.handleSlider = this.handleSlider.bind(this);\n    this.handleVideoEnd = this.handleVideoEnd.bind(this);\n  }\n\n  handleClick(id) {\n    console.log(`button pressed: ${id}`);\n    switch(id) {\n      case 'btn_start':\n        if(!this.state.isIdle) {\n          this.startVideo();\n        }\n        break;\n      case 'btn_end':\n      if(this.state.isIdle) {\n        this.stopVideo();\n      }\n        break;\n      case 'btn_cam':\n        const toggleCam = !this.state.sideCamVisible;\n        this.setState({sideCamVisible: toggleCam});\n        ///*// DEBUG TOGGLECAM\n        console.log(`  sideCamVisible: ${toggleCam}`);\n        //*/// DEBUG TOGGLECAM\n        break;\n      default:\n        break;\n    }\n  }\n\n  handleSlider(idIn, value) {\n    let data = this.state.prIn;\n    let id = idIn.replace('slider_', '');\n    // for category ratio\n    if(!id.match(/^\\d/)) {\n      const set = id.match(/^\\D*(?=_)/)[0];\n      const cat = parseInt(id.match(/\\d*$/)[0]);\n      let _value = parseFloat(value)/100;\n      for(let i = 0; i <= cat; i++) {\n        if(i > 0) {\n          _value -= data[set].prRatios.find(o => o.cat === i-1).pr;\n        }\n      }\n      const _value_diff = _value -\n        parseFloat(data[set].prRatios.find(o => o.cat === cat).pr);\n      data[set].prRatios.find(o => o.cat === cat).pr = _value;\n      data[set].prRatios.find(o => o.cat === cat+1).pr -= _value_diff;\n    }\n    // for motion ratio in category\n    else {\n      const cat = parseInt(id.match(/^\\d*(?=-)/)[0]);\n      let data_cat = data.motionGroup.prRatios.find(o => o.cat === cat).prRatios;\n      const key = data_cat.indexOf(data_cat.find(o => o.code === id));\n      let _value = parseFloat(value)/100;\n      for(let i = 0; i <= key; i++) {\n        if(i > 0) {\n          _value -= data_cat[i-1].pr;\n        }\n      }\n      const _value_diff = _value - parseFloat(data_cat[key].pr);\n      data_cat[key].pr = _value;\n      data_cat[key+1].pr -= _value_diff;\n      data.motionGroup.prRatios.find(o => o.cat === cat).prRatios = data_cat;\n    }\n    this.setState({prIn: data});\n    this.setPrOut();\n  }\n\n  showSideCam() {\n    return (this.state.sideCamVisible) ? \"visible\" : \"hidden\";\n  }\n\n  startVideo() {\n    const id = this.findMotion();\n    const video_front = document.querySelector(`#front_${id}`);\n    const video_side = document.querySelector(`#side_${id}`);\n    video_front.play();\n    video_side.play();\n    console.log(\"from startVideo in App:\");\n    console.log(`  start playing video: ${id}`);\n    console.log(`  video duration: ${video_front.duration}`);\n    this.setState({isIdle: true})\n    this.setState({videoDuration: video_front.duration})\n  }\n\n  stopVideo() {\n    this.setState({isIdle: false});\n  }\n\n  handleVideoTime(id) {\n    const video_front = document.querySelector(`#front_${id}`);\n    const video_progress =\n      video_front.currentTime / this.state.videoDuration * 100;\n    this.setState({videoProgress: video_progress});\n  }\n\n  handleVideoEnd(cam) {\n    if(cam === 'front') {\n      this.setState({videoDuration: 0});\n      console.log(\"from handleVideoEnd in App:\");\n      console.log(\"  video ended\");\n      if(this.state.isIdle) {\n        this.startVideo();\n      }\n    }\n  }\n\n  findMotion() {\n    let dice = Math.random();\n    let current = this.state.currentMotion;\n    let prev = this.state.prevMotion;\n    let fix = '1-a';\n    let prOutType = this.state.prOutType;\n    prOutType = (prOutType === 1) ?\n      ((current === fix) ? 2 : 1) : 1;\n    let prOut = (prOutType === 2) ? this.state.prOut2 : this.state.prOut1;\n    let temp = this.findCurrent(dice, prOut);\n    const trial = this.state.trial + 1;\n\n    ///*// DEBUG DICE\n    console.log(\"from findMotion in App:\");\n    console.log(\"======== iteration start ========\");\n    let debugbar = \"\";\n    for (let i = 0; i < 20 - trial.toString().length; i++) {\n      debugbar += \"-\";\n    }\n    console.log(`dice trial: ${trial} ${debugbar}`);\n    console.log(`  dice thrown: ${dice.toFixed(3)}`);\n    console.log(`  prev motion: ${current}`);\n    console.log(`  new motion: ${temp}`);\n    //*/// DEBUG DICE\n    while(temp === current && temp !== fix) {\n      dice = Math.random();\n      temp = this.findCurrent(dice, prOut);\n      ///*// DEBUG DICE REPEAT\n      console.log('  (repeat trial)');\n      console.log(`  dice thrown: ${dice.toFixed(3)}`);\n      console.log(`  new motion: ${temp}`);\n      //*/// DEBUG DICE REPEAT\n    }\n    ///*// DEBUG DICE\n    console.log(\"(dice trial ends) ---------------\");\n    //*/// DEBUG DICE\n\n    prev = current;\n    current = temp;\n    prOut.forEach(item => {\n      item.isPrev = false;\n      item.isCurrent = false;\n    });\n    const codes = prOut.map(item => {\n      return item.code;\n    });\n    if(codes.includes(prev)) {\n      prOut.find(o => o.code === prev).isPrev = true;\n    }\n    prOut.find(o => o.code === current).isCurrent = true;\n    this.setState({\n      dice: dice,\n      trial: trial,\n      prevMotion: prev,\n      currentMotion: current,\n      prOutType: prOutType,\n      prOut: prOut\n    });\n\n    ///*// DEBUG PROUT\n    console.log(\"prOut: \" + JSON.stringify(this.state.prOut, null, 2));\n    //*/// DEBUG PROUT\n\n    return current;\n  }\n\n  findCurrent(dice, prOut) {\n    for (let i = 0; i < prOut.length; i++) {\n      if(dice < prOut[i].pr) {\n        return prOut[i].code;\n      }\n    }\n  }\n\n  calcPrOut(prIn, target, prev, current) {\n    let _range = [];\n    let _cat;\n    let _pr_accum = 0;\n    let _data = (target === 1) ?\n      prIn.primary.prRatios : prIn.secondary.prRatios;\n    prIn.motionGroup.prRatios.forEach((item, index) => {\n      _cat = item.cat;\n      let pr_cat = _data.find(o => o.cat === _cat).pr;\n      let pr_accum_inCat = 0;\n      _pr_accum += (index > 0) ? _data[index-1].pr : 0;\n      item.prRatios.forEach((item, index, array) => {\n        pr_accum_inCat += pr_cat * item.pr;\n        let pr1 = _pr_accum + pr_accum_inCat;\n        let isCurrent = (item.code === current) ? true : false;\n        let isPrev = (item.code === prev) ? true : false;\n        let isEnd = (index === array.length - 1) ? true : false;\n        let output = {\n          code: item.code,\n          pr: pr1,\n          cat: _cat,\n          isCurrent: isCurrent,\n          isPrev: isPrev,\n          isEndOfCat: isEnd\n        };\n        _range.push(output);\n      });\n    });\n    return _range;\n  }\n\n  setPrOut() {\n    const _pr1 = this.calcPrOut(\n      this.state.prIn,\n      1,\n      this.state.prevMotion,\n      this.state.currentMotion\n    );\n    const _pr2 = this.calcPrOut(\n      this.state.prIn,\n      2,\n      this.state.prevMotion,\n      this.state.currentMotion\n    );\n    const prOut = (this.state.prOutType === 2) ? _pr2 : _pr1;\n    this.setState({\n      prOut: prOut,\n      prOut1: _pr1,\n      prOut2: _pr2\n    });\n  }\n\n  renderContents(cam) {\n    let codes = [];\n    //const _videoref = (cam === 'side') ? this.videoRefSide : this.videoRefFront;\n    const prOut = this.state.prOut;\n    const current = this.state.currentMotion;\n    prOut.forEach(item => {\n      codes.push(item.code);\n    });\n    let contents = [];\n    codes.forEach(item => {\n      const _isTarget = (item === current) ? true : false;\n      const _content = <Video\n        key={item}\n        //videoref={(_isTarget) ? _videoref : null}\n        id={`${cam}_${item}`}\n        src={require(`./video/${cam}_${item}.mp4`)}\n        visibility={_isTarget}\n        onTimeUpdate={() => this.handleVideoTime(item)}\n        onEnded={() => this.handleVideoEnd(cam)}\n      />;\n      contents.push(_content);\n    });\n    /*// DEBUG RENDER CONTENTS\n    console.log(\"from renderContents in App:\");\n    console.log(\"  updated video contents\");\n    console.log(`  current motion: ${this.state.currentMotion}`);\n    */// DEBUG RENDER CONTENTS\n    return contents;\n  }\n\n  render() {\n    return (\n      <div className=\"App\">\n        <Placeholder\n        id=\"box_cam_front\"\n          content={\n            <div>\n              <Img src={require('./img/front_default.jpg')}/>\n              {this.renderContents('front')}\n            </div>\n          }\n          visibility={true}\n        />\n        <Placeholder\n        id=\"box_cam_side\"\n          content={\n            <div>\n              <Img src={require('./img/side_default.jpg')}/>\n              {this.renderContents('side')}\n            </div>\n          }\n          visibility={this.state.sideCamVisible}\n        />\n        <Dashboard\n          prOut={this.state.prOut}\n          prevMotion={this.state.prevMotion}\n          dice={this.state.dice}\n        />\n        <Controlboard\n          data={this.state.prIn}\n          onSliderChange={this.handleSlider}\n          />\n        <Footer\n          onClick={id => this.handleClick(id)}\n          progressvalue={this.state.videoProgress}\n        />\n      </div>\n    );\n  }\n}\nexport default App;\n"]},"metadata":{},"sourceType":"module"}